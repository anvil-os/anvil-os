
#include <stddef.h>
#include <stdlib.h>
#include <limits.h>
#include <stdint.h>

#include "test_harness.h"

TEST_GROUP(stdlib)

TEST(stdlib, strtol)
{
    long (* volatile STRTOL)(const char *restrict nptr, char **restrict endptr, int base) = strtol;

    ASSERT_EQ(LONG_MIN, STRTOL("-18446744073709551616", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-18446744073709551615", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-18446744073709551614", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-9223372036854775810", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-9223372036854775809", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-9223372036854775808", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-9223372036854775807", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-9223372036854775806", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-9223372036854775805", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-9223372036854775804", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-2147483649", NULL, 10));
    ASSERT_EQ(LONG_MIN, STRTOL("-2147483648", NULL, 10));
    ASSERT_EQ(-2147483647, STRTOL("-2147483647", NULL, 10));
    ASSERT_EQ(-2147483646, STRTOL("-2147483646", NULL, 10));
    ASSERT_EQ(-2147483645, STRTOL("-2147483645", NULL, 10));
    ASSERT_EQ(-3, STRTOL("-3", NULL, 10));
    ASSERT_EQ(-2, STRTOL("-2", NULL, 10));
    ASSERT_EQ(-1, STRTOL("-1", NULL, 10));
    ASSERT_EQ(0, STRTOL("0", NULL, 10));
    ASSERT_EQ(1, STRTOL("1", NULL, 10));
    ASSERT_EQ(2, STRTOL("2", NULL, 10));
    ASSERT_EQ(3, STRTOL("3", NULL, 10));
    ASSERT_EQ(2147483645, STRTOL("2147483645", NULL, 10));
    ASSERT_EQ(2147483646, STRTOL("2147483646", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("2147483647", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("2147483648", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("2147483649", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("9223372036854775804", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("9223372036854775805", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("9223372036854775806", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("9223372036854775807", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("9223372036854775808", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("9223372036854775809", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("9223372036854775810", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("18446744073709551614", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("18446744073709551615", NULL, 10));
    ASSERT_EQ(LONG_MAX, STRTOL("18446744073709551616", NULL, 10));

    END_TEST(stdlib);
}

TEST(stdlib, strtoul)
{
    unsigned long (* volatile STRTOUL)(const char *restrict nptr, char **restrict endptr, int base) = strtoul;

    ASSERT_EQ(-ULONG_MAX, STRTOUL("-18446744073709551616", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-18446744073709551615", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-18446744073709551614", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-9223372036854775810", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-9223372036854775809", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-9223372036854775808", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-9223372036854775807", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-9223372036854775806", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-9223372036854775805", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-9223372036854775804", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-4294967297", NULL, 10));
    ASSERT_EQ(-ULONG_MAX, STRTOUL("-4294967296", NULL, 10));
    ASSERT_EQ(1, STRTOUL("-4294967295", NULL, 10));
    ASSERT_EQ(2, STRTOUL("-4294967294", NULL, 10));
    ASSERT_EQ(3, STRTOUL("-4294967293", NULL, 10));
    ASSERT_EQ(2147483647, STRTOUL("-2147483649", NULL, 10));
    ASSERT_EQ(2147483648, STRTOUL("-2147483648", NULL, 10));
    ASSERT_EQ(2147483649, STRTOUL("-2147483647", NULL, 10));
    ASSERT_EQ(2147483650, STRTOUL("-2147483646", NULL, 10));
    ASSERT_EQ(2147483651, STRTOUL("-2147483645", NULL, 10));
    ASSERT_EQ(4294967293, STRTOUL("-3", NULL, 10));
    ASSERT_EQ(4294967294, STRTOUL("-2", NULL, 10));
    ASSERT_EQ(4294967295, STRTOUL("-1", NULL, 10));
    ASSERT_EQ(0, STRTOUL("0", NULL, 10));
    ASSERT_EQ(1, STRTOUL("1", NULL, 10));
    ASSERT_EQ(2, STRTOUL("2", NULL, 10));
    ASSERT_EQ(3, STRTOUL("3", NULL, 10));
    ASSERT_EQ(2147483645, STRTOUL("2147483645", NULL, 10));
    ASSERT_EQ(2147483646, STRTOUL("2147483646", NULL, 10));
    ASSERT_EQ(2147483647, STRTOUL("2147483647", NULL, 10));
    ASSERT_EQ(2147483648, STRTOUL("2147483648", NULL, 10));
    ASSERT_EQ(2147483649, STRTOUL("2147483649", NULL, 10));
    ASSERT_EQ(4294967293, STRTOUL("4294967293", NULL, 10));
    ASSERT_EQ(4294967294, STRTOUL("4294967294", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("4294967295", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("4294967296", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("4294967297", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("9223372036854775804", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("9223372036854775805", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("9223372036854775806", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("9223372036854775807", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("9223372036854775808", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("9223372036854775809", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("9223372036854775810", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("18446744073709551614", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("18446744073709551615", NULL, 10));
    ASSERT_EQ(ULONG_MAX, STRTOUL("18446744073709551616", NULL, 10));

    END_TEST(stdlib);
}

TEST(stdlib, strtoll)
{
    long long (* volatile STRTOLL)(const char *restrict nptr, char **restrict endptr, int base) = strtoll;

    ASSERT_EQ(LLONG_MIN, STRTOLL("-18446744073709551616", NULL, 10));
    ASSERT_EQ(LLONG_MIN, STRTOLL("-18446744073709551615", NULL, 10));
    ASSERT_EQ(LLONG_MIN, STRTOLL("-18446744073709551614", NULL, 10));
    ASSERT_EQ(LLONG_MIN, STRTOLL("-9223372036854775810", NULL, 10));
    ASSERT_EQ(LLONG_MIN, STRTOLL("-9223372036854775809", NULL, 10));
    ASSERT_EQ(LLONG_MIN, STRTOLL("-9223372036854775808", NULL, 10));
    ASSERT_EQ(-9223372036854775807LL, STRTOLL("-9223372036854775807", NULL, 10));
    ASSERT_EQ(-9223372036854775806LL, STRTOLL("-9223372036854775806", NULL, 10));
    ASSERT_EQ(-9223372036854775805LL, STRTOLL("-9223372036854775805", NULL, 10));
    ASSERT_EQ(-9223372036854775804LL, STRTOLL("-9223372036854775804", NULL, 10));
    ASSERT_EQ(-2147483649, STRTOLL("-2147483649", NULL, 10));
    ASSERT_EQ(-2147483648, STRTOLL("-2147483648", NULL, 10));
    ASSERT_EQ(-2147483647, STRTOLL("-2147483647", NULL, 10));
    ASSERT_EQ(-2147483646, STRTOLL("-2147483646", NULL, 10));
    ASSERT_EQ(-2147483645, STRTOLL("-2147483645", NULL, 10));
    ASSERT_EQ(-3, STRTOLL("-3", NULL, 10));
    ASSERT_EQ(-2, STRTOLL("-2", NULL, 10));
    ASSERT_EQ(-1, STRTOLL("-1", NULL, 10));
    ASSERT_EQ(0, STRTOLL("0", NULL, 10));
    ASSERT_EQ(1, STRTOLL("1", NULL, 10));
    ASSERT_EQ(2, STRTOLL("2", NULL, 10));
    ASSERT_EQ(3, STRTOLL("3", NULL, 10));
    ASSERT_EQ(2147483645, STRTOLL("2147483645", NULL, 10));
    ASSERT_EQ(2147483646, STRTOLL("2147483646", NULL, 10));
    ASSERT_EQ(2147483647, STRTOLL("2147483647", NULL, 10));
    ASSERT_EQ(2147483648, STRTOLL("2147483648", NULL, 10));
    ASSERT_EQ(2147483649, STRTOLL("2147483649", NULL, 10));
    ASSERT_EQ(9223372036854775804, STRTOLL("9223372036854775804", NULL, 10));
    ASSERT_EQ(9223372036854775805, STRTOLL("9223372036854775805", NULL, 10));
    ASSERT_EQ(9223372036854775806, STRTOLL("9223372036854775806", NULL, 10));
    ASSERT_EQ(9223372036854775807, STRTOLL("9223372036854775807", NULL, 10));
    ASSERT_EQ(LLONG_MAX, STRTOLL("9223372036854775808", NULL, 10));
    ASSERT_EQ(LLONG_MAX, STRTOLL("9223372036854775809", NULL, 10));
    ASSERT_EQ(LLONG_MAX, STRTOLL("9223372036854775810", NULL, 10));
    ASSERT_EQ(LLONG_MAX, STRTOLL("18446744073709551614", NULL, 10));
    ASSERT_EQ(LLONG_MAX, STRTOLL("18446744073709551615", NULL, 10));
    ASSERT_EQ(LLONG_MAX, STRTOLL("18446744073709551616", NULL, 10));

    END_TEST(stdlib);
}

TEST(stdlib, strtoull)
{
    unsigned long long (* volatile STRTOULL)(const char *restrict nptr, char **restrict endptr, int base) = strtoull;

    ASSERT_EQ(1, STRTOULL("-18446744073709551618", NULL, 10));
    ASSERT_EQ(1, STRTOULL("-18446744073709551617", NULL, 10));
    ASSERT_EQ(1, STRTOULL("-18446744073709551616", NULL, 10));
    ASSERT_EQ(1, STRTOULL("-18446744073709551615", NULL, 10));
    ASSERT_EQ(2, STRTOULL("-18446744073709551614", NULL, 10));
    ASSERT_EQ(9223372036854775806U, STRTOULL("-9223372036854775810", NULL, 10));
    ASSERT_EQ(9223372036854775807U, STRTOULL("-9223372036854775809", NULL, 10));
    ASSERT_EQ(9223372036854775808U, STRTOULL("-9223372036854775808", NULL, 10));
    ASSERT_EQ(9223372036854775809U, STRTOULL("-9223372036854775807", NULL, 10));
    ASSERT_EQ(9223372036854775810U, STRTOULL("-9223372036854775806", NULL, 10));
    ASSERT_EQ(9223372036854775811U, STRTOULL("-9223372036854775805", NULL, 10));
    ASSERT_EQ(9223372036854775812U, STRTOULL("-9223372036854775804", NULL, 10));
    ASSERT_EQ(18446744069414584319U, STRTOULL("-4294967297", NULL, 10));
    ASSERT_EQ(18446744069414584320U, STRTOULL("-4294967296", NULL, 10));
    ASSERT_EQ(18446744069414584321U, STRTOULL("-4294967295", NULL, 10));
    ASSERT_EQ(18446744069414584322U, STRTOULL("-4294967294", NULL, 10));
    ASSERT_EQ(18446744069414584323U, STRTOULL("-4294967293", NULL, 10));
    ASSERT_EQ(18446744071562067967U, STRTOULL("-2147483649", NULL, 10));
    ASSERT_EQ(18446744071562067968U, STRTOULL("-2147483648", NULL, 10));
    ASSERT_EQ(18446744071562067969U, STRTOULL("-2147483647", NULL, 10));
    ASSERT_EQ(18446744071562067970U, STRTOULL("-2147483646", NULL, 10));
    ASSERT_EQ(18446744071562067971U, STRTOULL("-2147483645", NULL, 10));
    ASSERT_EQ(18446744073709551613U, STRTOULL("-3", NULL, 10));
    ASSERT_EQ(18446744073709551614U, STRTOULL("-2", NULL, 10));
    ASSERT_EQ(18446744073709551615U, STRTOULL("-1", NULL, 10));
    ASSERT_EQ(0, STRTOULL("0", NULL, 10));
    ASSERT_EQ(1, STRTOULL("1", NULL, 10));
    ASSERT_EQ(2, STRTOULL("2", NULL, 10));
    ASSERT_EQ(3, STRTOULL("3", NULL, 10));
    ASSERT_EQ(2147483645, STRTOULL("2147483645", NULL, 10));
    ASSERT_EQ(2147483646, STRTOULL("2147483646", NULL, 10));
    ASSERT_EQ(2147483647, STRTOULL("2147483647", NULL, 10));
    ASSERT_EQ(2147483648, STRTOULL("2147483648", NULL, 10));
    ASSERT_EQ(2147483649, STRTOULL("2147483649", NULL, 10));
    ASSERT_EQ(4294967293, STRTOULL("4294967293", NULL, 10));
    ASSERT_EQ(4294967294, STRTOULL("4294967294", NULL, 10));
    ASSERT_EQ(4294967295, STRTOULL("4294967295", NULL, 10));
    ASSERT_EQ(4294967296, STRTOULL("4294967296", NULL, 10));
    ASSERT_EQ(4294967297, STRTOULL("4294967297", NULL, 10));
    ASSERT_EQ(9223372036854775804, STRTOULL("9223372036854775804", NULL, 10));
    ASSERT_EQ(9223372036854775805, STRTOULL("9223372036854775805", NULL, 10));
    ASSERT_EQ(9223372036854775806, STRTOULL("9223372036854775806", NULL, 10));
    ASSERT_EQ(9223372036854775807, STRTOULL("9223372036854775807", NULL, 10));
    ASSERT_EQ(9223372036854775808U, STRTOULL("9223372036854775808", NULL, 10));
    ASSERT_EQ(9223372036854775809U, STRTOULL("9223372036854775809", NULL, 10));
    ASSERT_EQ(9223372036854775810U, STRTOULL("9223372036854775810", NULL, 10));
    ASSERT_EQ(18446744073709551614U, STRTOULL("18446744073709551614", NULL, 10));
    ASSERT_EQ(18446744073709551615U, STRTOULL("18446744073709551615", NULL, 10));
    ASSERT_EQ(ULLONG_MAX, STRTOULL("18446744073709551616", NULL, 10));
    ASSERT_EQ(ULLONG_MAX, STRTOULL("18446744073709551617", NULL, 10));
    ASSERT_EQ(ULLONG_MAX, STRTOULL("18446744073709551618", NULL, 10));

    END_TEST(stdlib);
}

TEST(stdlib, div)
{
    div_t res;

    //  I got this table from stack overflow
    //
    //     n     |  d     |  q     |  r
    //    -------|--------|--------|--------
    //     7     |  3     |  2     |  1
    //    -7     |  3     | -2     | -1
    //     7     | -3     | -2     |  1
    //    -7     | -3     |  2     | -1

    res = div(7, 3);
    ASSERT_EQ(2, res.quot);
    ASSERT_EQ(1, res.rem);

    res = div(-7, 3);
    ASSERT_EQ(-2, res.quot);
    ASSERT_EQ(-1, res.rem);

    res = div(7, -3);
    ASSERT_EQ(-2, res.quot);
    ASSERT_EQ(1, res.rem);

    res = div(-7, -3);
    ASSERT_EQ(2, res.quot);
    ASSERT_EQ(-1, res.rem);

    END_TEST(stdlib);
}

int stdlib_test()
{
    CALL_TEST(stdlib, strtol);
    CALL_TEST(stdlib, strtoul);
    CALL_TEST(stdlib, strtoll);
    CALL_TEST(stdlib, strtoull);

    CALL_TEST(stdlib, div);

    END_TEST_GROUP(stdlib);
}
